!function(t,i){"function"==typeof define&&define.amd?define(["exports","riot"],function(e,n){i(t.translate=e,n)}):"object"==typeof exports?i(exports,require("riot")):i(t.translate={},t.riot)}(this,function(t,i){var e="en";function n(){this._entities={},this._default=e,this._language=this._default;var t=i.observable();this.on=t.on,this.off=t.off,this.trigger=t.trigger,this.on("lang",this.setLanguage)}n.prototype.dictionary=function(t){this._entities=t},n.prototype.defaultLanguage=function(t){this._default=t},n.prototype.apply=function(t,i){var e,n;function a(t,i,e,n){n=n||"",i=i||{},e=e||0;var s,r=t&&!t.length,o=r?Object.keys(t).length:0;if(r&&o>0)for(s in t)n.split(".").length>e&&(n=n.split(".").splice(0,e).join(".")),n=0==e?s:n+"."+s,i=a(t[s],i,e+1,n);else i[n]=t;return i}if(this._entities[this._language]||(e=t),e||(e=(n=a(this._entities[this._language]))[t]?n[t]:t),i){var s,r=a(i);for(s in r)e=e.replace(new RegExp("{"+s+"}","g"),r[s])}return e},n.prototype.setLanguage=function(t){this._language=t||this._default,this.trigger("update")},n.prototype.getLanguage=function(){return this._language};var a,s=new n;for(a in s)t[a]=s[a];i.mixin("translate",{translate:t}),i.tag2("translate",'<span ref="original"><yield></yield></span>','translate,[riot-tag="translate"],[data-is="translate"]{ display: inline; }',"",function(t){this.mixin("translate"),this.translate.on("update",function(){this.update()}.bind(this)),this.on("mount",function(){this.hasRefs=null!=this.refs,this.apply()}),this.on("update",function(){this.apply()}),this.apply=function(){var t=this.hasRefs?this.refs:this,i=this.translate.apply(t.original.innerHTML);for(var e in this.opts)i=i.replace("{"+e.replace(/([A-Z])/g,"-$1").toLowerCase()+"}",this.opts[e]);for(var n=this.root;n.hasChildNodes();)n.removeChild(n.firstChild);var a=document.createElement("span");a.innerHTML=i,n.appendChild(a)}})});
